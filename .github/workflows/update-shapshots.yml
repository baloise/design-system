name: ðŸ“¸ Update Snapshots

on:
  workflow_dispatch:

jobs:
  snapshot:
    name: ðŸ“¸ Update Snapshots
    runs-on: ubuntu-22.04
    timeout-minutes: 30
    env:
      HUSKY: 0
      CI: true
    container:
      image: mcr.microsoft.com/playwright:v1.56.1-noble
      options: --user 1001
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.PRE_RELEASE_GITHUB_TOKEN }}
          fetch-depth: 0
          ref: ${{ github.head_ref }}

      - uses: ./.github/workflows/actions/setup

      - name: Clean install
        run: npm ci

      - name: Build Core
        run: npx nx run core:build

      - name: Run Playwright tests
        run: npx nx run core:e2e-update-screenshots

      - name: Commit snapshots
        uses: EndBug/add-and-commit@v9
        with:
          message: 'update snapshots'
        env:
          GITHUB_TOKEN: ${{ secrets.PRE_RELEASE_GITHUB_TOKEN }}
